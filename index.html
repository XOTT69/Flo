<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>–¶–∏–∫–ª (mini Flo)</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="–¶–∏–∫–ª">
  <style>
    *{box-sizing:border-box}
    body{
      margin:0;padding:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:linear-gradient(135deg,#f5f7fa,#e0e7ff);
      min-height:100vh;display:flex;flex-direction:column;
    }
    .app{
      max-width:420px;margin:0 auto;
      padding:12px 12px 72px;
      flex:1;
    }
    .card{
      background:#fff;border-radius:18px;
      padding:16px 14px;margin-bottom:12px;
      box-shadow:0 8px 18px rgba(15,23,42,0.08);
    }
    h1{margin:0 0 4px;font-size:22px;color:#111827}
    h2{margin:0 0 10px;font-size:17px;color:#111827}
    .subtitle{color:#6b7280;font-size:13px;margin-bottom:8px}
    label{font-size:13px;color:#6b7280}
    input,button{
      width:100%;padding:10px 12px;margin-top:6px;
      border-radius:12px;border:1px solid #e5e7eb;font-size:15px;
    }
    button{
      border:none;background:linear-gradient(135deg,#6366f1,#4f46e5);
      color:#fff;font-weight:600;cursor:pointer;
    }
    button:active{transform:scale(.98)}
    .btn-secondary{background:#f3f4ff;color:#4338ca;border:1px solid #e5e7eb}
    .pill{
      display:inline-block;padding:4px 8px;border-radius:999px;
      font-size:11px;background:#eef2ff;color:#4338ca;margin-right:4px;margin-bottom:4px;
    }
    .tip{font-size:13px;color:#111827;margin-top:6px}
    .tip small{color:#6b7280}
    .grid-7{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-top:10px}
    .day-header{font-size:11px;color:#9ca3af;text-align:center}
    .day{
      background:#f9fafb;border-radius:10px;
      text-align:center;padding:8px 4px;font-size:13px;
      position:relative;
    }
    .today{border:2px solid #6366f1}
    .period{background:#fee2e2;color:#b91c1c}
    .predicted{background:#e0f2fe;color:#0369a1}
    .fertile{border:1px dashed #22c55e}
    .dot{
      .cycle-day-label {
  font-size: 10px;
  color: #6b7280;
  margin-top: 2px;
}
      width:6px;height:6px;border-radius:50%;
      background:#6366f1;position:absolute;bottom:4px;left:50%;transform:translateX(-50%);
    }
    .symptom-chip{
      padding:7px 10px;border-radius:999px;
      border:1px solid #e5e7eb;font-size:12px;
      display:inline-block;margin:3px 4px;cursor:pointer;
      background:#f9fafb;
    }
    .symptom-chip.active{
      background:#4f46e5;color:#fff;border-color:#4338ca;
    }
    .tabs{
      position:fixed;bottom:0;left:0;right:0;
      max-width:420px;margin:0 auto;
      background:#fff;border-top:1px solid #e5e7eb;
      display:flex;
    }
    .tab{
      flex:1;padding:8px 4px;text-align:center;
      font-size:11px;color:#6b7280;cursor:pointer;
    }
    .tab span{display:block;font-size:18px;margin-bottom:2px}
    .tab.active{color:#4f46e5;font-weight:600}
    .screen{display:none}
    .screen.active{display:block}
  </style>
</head>
<body>
  <div class="app">
    <!-- –ì–û–õ–û–í–ù–ê -->
    <div id="screen-home" class="screen active">
      <div class="card">
        <h1>–¶–∏–∫–ª –¥—Ä—É–∂–∏–Ω–∏</h1>
        <div class="subtitle">–Ø–∫ —É Flo, –∞–ª–µ —Å–≤–æ—î –π –ø—Ä–∏–≤–∞—Ç–Ω–µ</div>

        <label>–î–∞—Ç–∞ –ø–æ—á–∞—Ç–∫—É –æ—Å—Ç–∞–Ω–Ω—ñ—Ö –º—ñ—Å—è—á–Ω–∏—Ö</label>
        <input type="date" id="lastPeriod">
        <label>–°–µ—Ä–µ–¥–Ω—è –¥–æ–≤–∂–∏–Ω–∞ —Ü–∏–∫–ª—É (–¥–Ω—ñ–≤)</label>
        <input type="number" id="cycleLength" value="28" min="21" max="40">
        <label>–î–æ–≤–∂–∏–Ω–∞ –º—ñ—Å—è—á–Ω–∏—Ö (–¥–Ω—ñ–≤)</label>
        <input type="number" id="periodLength" value="5" min="2" max="10">

        <button id="btnToday">–°—å–æ–≥–æ–¥–Ω—ñ –ø–æ—á–∞–ª–∏—Å—å</button>
        <button class="btn-secondary" id="btnSaveBase">–ó–±–µ—Ä–µ–≥—Ç–∏ –±–∞–∑–æ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</button>

        <div id="status" class="tip"></div>
      </div>

      <div class="card">
        <h2>–°—å–æ–≥–æ–¥–Ω—ñ</h2>
        <div id="todayInfo" class="tip"></div>
        <div id="todayTip" class="tip"></div>
      </div>

      <div class="card">
        <h2>–ü—Ä–æ–≥–Ω–æ–∑</h2>
        <div id="forecast" class="tip"></div>
      </div>
    </div>

    <!-- –ö–ê–õ–ï–ù–î–ê–† -->
    <div id="screen-calendar" class="screen">
      <div class="card">
        <h2>–ö–∞–ª–µ–Ω–¥–∞—Ä —Ü–∏–∫–ª—É</h2>
        <div class="tip">
          <span class="pill" style="background:#fee2e2;color:#b91c1c">–ú—ñ—Å—è—á–Ω—ñ</span>
          <span class="pill" style="background:#e0f2fe;color:#0369a1">–û—á—ñ–∫—É—é—Ç—å—Å—è</span>
          <span class="pill" style="border:1px dashed #22c55e;background:#ecfdf5;color:#166534">–§–µ—Ä—Ç–∏–ª—å–Ω—ñ</span>
          <span class="pill" style="background:#eef2ff;color:#4338ca">‚óè —Å–∏–º–ø—Ç–æ–º–∏</span>
        </div>
        <div class="grid-7" id="calendar"></div>
      </div>
    </div>

    <!-- –©–û–î–ï–ù–ù–ò–ö -->
    <div id="screen-log" class="screen">
      <div class="card">
        <h2>–°–∏–º–ø—Ç–æ–º–∏ —Å—å–æ–≥–æ–¥–Ω—ñ</h2>
        <div id="symptomChips"></div>
        <div class="tip"><small>–ù–∞—Ç–∏—Å–Ω–∏, —â–æ–± –≤—ñ–¥–º—ñ—Ç–∏—Ç–∏. –ó–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –ø–æ –¥–Ω—è—Ö —Ü–∏–∫–ª—É.</small></div>
      </div>

      <div class="card">
        <h2>–ú–∞–ª—ñ —ñ–Ω—Å–∞–π—Ç–∏</h2>
        <div id="insights" class="tip"></div>
      </div>
    </div>
  </div>

  <!-- –¢–ê–ë–ò -->
  <div class="tabs">
    <div class="tab active" data-screen="home">
      <span>üè†</span>–ì–æ–ª–æ–≤–Ω–∞
    </div>
    <div class="tab" data-screen="calendar">
      <span>üìÖ</span>–ö–∞–ª–µ–Ω–¥–∞—Ä
    </div>
    <div class="tab" data-screen="log">
      <span>üìì</span>–©–æ–¥–µ–Ω–Ω–∏–∫
    </div>
  </div>

<script>
  // TAB LOGIC
  document.querySelectorAll('.tab').forEach(tab=>{
    tab.onclick=()=>{
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      tab.classList.add('active');
      const target=tab.getAttribute('data-screen');
      document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
      document.getElementById('screen-'+target).classList.add('active');
    };
  });

  const LS_CYCLES = 'cycles_v2';
  const LS_SYMPTOMS = 'symptoms_v2';
  const LS_BASE = 'base_settings_v1';

  let cycles = JSON.parse(localStorage.getItem(LS_CYCLES) || '[]'); // [{start,length,period}]
  let daySymptoms = JSON.parse(localStorage.getItem(LS_SYMPTOMS) || '{}'); // { 'YYYY-MM-DD': ['–ë—ñ–ª—å',...] }

  const symptomList = ['–ë—ñ–ª—å','–ù–∞—Å—Ç—Ä—ñ–π','–°–æ–Ω','–í–∞–≥–∞','–ì–æ–ª–æ–≤–Ω–∏–π –±—ñ–ª—å','–ù–∞–±—Ä—è–∫–∏'];

  function saveCycles(){localStorage.setItem(LS_CYCLES,JSON.stringify(cycles.slice(0,24)));}
  function saveSymptoms(){localStorage.setItem(LS_SYMPTOMS,JSON.stringify(daySymptoms));}

  function loadBaseSettings(){
    const base = JSON.parse(localStorage.getItem(LS_BASE) || 'null');
    if(base){
      document.getElementById('cycleLength').value = base.cycle || 28;
      document.getElementById('periodLength').value = base.period || 5;
    }
  }
  function saveBaseSettings(){
    const cycle = parseInt(document.getElementById('cycleLength').value)||28;
    const period = parseInt(document.getElementById('periodLength').value)||5;
    localStorage.setItem(LS_BASE,JSON.stringify({cycle,period}));
    document.getElementById('status').innerText='–ó–±–µ—Ä–µ–∂–µ–Ω–æ.';
  }

  document.getElementById('btnSaveBase').onclick = saveBaseSettings;

  function addCycle(dateStr){
    const cycle = parseInt(document.getElementById('cycleLength').value)||28;
    const period = parseInt(document.getElementById('periodLength').value)||5;
    cycles.unshift({start:dateStr,length:cycle,period});
    saveCycles();
    document.getElementById('lastPeriod').value=dateStr;
    refreshAll();
  }

  document.getElementById('btnToday').onclick=()=>{
    const todayStr=new Date().toISOString().slice(0,10);
    addCycle(todayStr);
  };
  document.getElementById('lastPeriod').addEventListener('change',e=>{
    if(e.target.value) addCycle(e.target.value);
  });

  function getDayDiff(a,b){
    const d1=new Date(a);d1.setHours(0,0,0,0);
    const d2=new Date(b);d2.setHours(0,0,0,0);
    return Math.round((d2-d1)/86400000);
  }

  function calcForecast(){
    if(cycles.length===0) return null;
    const last=cycles[0];
    const lengths=cycles.slice(0,8).map(c=>c.length);
    const avg=lengths.reduce((s,x)=>s+x,0)/lengths.length;
    const min=Math.min(...lengths);
    const max=Math.max(...lengths);
    const lastDate=new Date(last.start);
    const nextMin=new Date(lastDate.getTime()+min*86400000);
    const nextMax=new Date(lastDate.getTime()+max*86400000);
    const ovulation=new Date(lastDate.getTime()+(avg-14)*86400000);
    return {avg,min,max,nextMin,nextMax,ovulation};
  }

  function forecastText(){
    const f=calcForecast();
    const el=document.getElementById('forecast');
    if(!f){el.innerHTML='–í—ñ–¥–º—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–∏–Ω —Ü–∏–∫–ª, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –ø—Ä–æ–≥–Ω–æ–∑.';return;}
    const today=new Date();today.setHours(0,0,0,0);
    const daysToMin=getDayDiff(today,f.nextMin);
    const daysToMax=getDayDiff(today,f.nextMax);
    const rangeText=`${f.nextMin.toLocaleDateString('uk-UA')} ‚Äì ${f.nextMax.toLocaleDateString('uk-UA')}`;
    const toText=daysToMin===daysToMax
      ? `—á–µ—Ä–µ–∑ ${daysToMin} –¥–Ω—ñ–≤`
      : `–ø—Ä–∏–±–ª–∏–∑–Ω–æ —á–µ—Ä–µ–∑ ${daysToMin}‚Äì${daysToMax} –¥–Ω—ñ–≤`;
    el.innerHTML = `
      –ù–∞—Å—Ç—É–ø–Ω—ñ –º—ñ—Å—è—á–Ω—ñ: <strong>${rangeText}</strong> (${toText}).<br>
      –°–µ—Ä–µ–¥–Ω—ñ–π —Ü–∏–∫–ª: <strong>${Math.round(f.avg)} –¥–Ω—ñ–≤</strong> (–∫–æ–ª–∏–≤–∞—î—Ç—å—Å—è ${f.min}‚Äì${f.max}).<br>
      –û–≤—É–ª—è—Ü—ñ—è –æ—Ä—ñ—î–Ω—Ç–æ–≤–Ω–æ: <strong>${f.ovulation.toLocaleDateString('uk-UA')}</strong>.
    `;
  }

  function buildCalendar(){
    const cont=document.getElementById('calendar');
    cont.innerHTML='';
    const weekDays=['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–ù–¥'];
    weekDays.forEach(d=>{
      const h=document.createElement('div');
      h.className='day-header';
      h.textContent=d;
      cont.appendChild(h);
    });

    const today=new Date();today.setHours(0,0,0,0);
    const startMonth=new Date(today.getFullYear(),today.getMonth(),1);
    const offset=(startMonth.getDay()+6)%7;
    for(let i=0;i<offset;i++){cont.appendChild(document.createElement('div'));}

    const daysInMonth=new Date(today.getFullYear(),today.getMonth()+1,0).getDate();
    const f=calcForecast();

    for(let d=1;d<=daysInMonth;d++){
      const date=new Date(today.getFullYear(),today.getMonth(),d);
      date.setHours(0,0,0,0);
      const dateStr=date.toISOString().slice(0,10);
      const cell=document.createElement('div');
      cell.className='day';
      cell.textContent=d;
      if(date.getTime()===today.getTime()) cell.classList.add('today');

      cycles.forEach(c=>{
        const s=new Date(c.start);s.setHours(0,0,0,0);
        const e=new Date(s.getTime()+c.period*86400000);
        if(date>=s && date<e) cell.classList.add('period');
      });

      if(f){
        const last=cycles[0];
        const s=new Date(last.start);s.setHours(0,0,0,0);
        const diff=getDayDiff(s,date);
        if(diff>=f.min && diff<=f.max) cell.classList.add('predicted');
        const fertileStart=Math.round(f.avg-14-3);
        const fertileEnd=Math.round(f.avg-14+3);
        if(diff>=fertileStart && diff<=fertileEnd) cell.classList.add('fertile');
      }

      if(daySymptoms[dateStr] && daySymptoms[dateStr].length){
        const dot=document.createElement('div');
        dot.className='dot';
        cell.appendChild(dot);
        cell.title=daySymptoms[dateStr].join(', ');
      }
      cont.appendChild(cell);
    }
  }

  function buildSymptomChips(){
    const wrap=document.getElementById('symptomChips');
    wrap.innerHTML='';
    const todayStr=new Date().toISOString().slice(0,10);
    const todayList=daySymptoms[todayStr]||[];

    symptomList.forEach(name=>{
      const chip=document.createElement('div');
      chip.className='symptom-chip'+(todayList.includes(name)?' active':'');
      chip.textContent=name;
      chip.onclick=()=>{
        const list=daySymptoms[todayStr]||[];
        const i=list.indexOf(name);
        if(i>-1) list.splice(i,1); else list.push(name);
        daySymptoms[todayStr]=list;
        if(list.length===0) delete daySymptoms[todayStr];
        saveSymptoms();
        buildSymptomChips();
        updateTodayTip();
        updateInsights();
      };
      wrap.appendChild(chip);
    });
  }

  function updateTodayInfo(){
    const el=document.getElementById('todayInfo');
    if(cycles.length===0){
      el.innerHTML='–ù–µ–º–∞—î —â–µ –∂–æ–¥–Ω–æ–≥–æ —Ü–∏–∫–ª—É. –ù–∞—Ç–∏—Å–Ω–∏ ‚Äú–°—å–æ–≥–æ–¥–Ω—ñ –ø–æ—á–∞–ª–∏—Å—å‚Äù –∞–±–æ –æ–±–µ—Ä–∏ –¥–∞—Ç—É –æ—Å—Ç–∞–Ω–Ω—ñ—Ö.';
      return;
    }
    const last=cycles[0];
    const today=new Date();today.setHours(0,0,0,0);
    const start=new Date(last.start);start.setHours(0,0,0,0);
    const dayInCycle=getDayDiff(start,today)+1;
    if(dayInCycle<=0){
      el.innerHTML='–ú–∏ —â–µ –¥–æ –ø–æ—á–∞—Ç–∫—É –∑–±–µ—Ä–µ–∂–µ–Ω–æ–≥–æ —Ü–∏–∫–ª—É. –ü–µ—Ä–µ–≤—ñ—Ä –¥–∞—Ç—É.';
      return;
    }
    el.innerHTML=`–°—å–æ–≥–æ–¥–Ω—ñ <strong>${dayInCycle}</strong>-–π –¥–µ–Ω—å —Ü–∏–∫–ª—É –∑ ~<strong>${last.length}</strong> –¥–Ω—ñ–≤.`;
  }

  function updateTodayTip(){
    const tipEl=document.getElementById('todayTip');
    if(cycles.length===0){tipEl.innerHTML='';return;}
    const last=cycles[0];
    const today=new Date();today.setHours(0,0,0,0);
    const start=new Date(last.start);start.setHours(0,0,0,0);
    const dayInCycle=getDayDiff(start,today)+1;
    const cycleLen=last.length;
    const todayStr=today.toISOString().slice(0,10);
    const syms=daySymptoms[todayStr]||[];
    let text='';

    if(dayInCycle>=1 && dayInCycle<=last.period){
      text='–ü–µ—Ä—à—ñ –¥–Ω—ñ —Ü–∏–∫–ª—É. –ù–æ—Ä–º–∞–ª—å–Ω–æ –≤—ñ–¥—á—É–≤–∞—Ç–∏ –≤—Ç–æ–º—É –∞–±–æ –±—ñ–ª—å. –ë—ñ–ª—å—à–µ –≤—ñ–¥–ø–æ—á–∏–Ω–∫—É –π —Ç–µ–ø–ª–∞.';
    }else if(dayInCycle<cycleLen-7){
      text='–°–µ—Ä–µ–¥–∏–Ω–∞ —Ü–∏–∫–ª—É. –ß–∞—Å—Ç–æ –±—ñ–ª—å—à–µ –µ–Ω–µ—Ä–≥—ñ—ó ‚Äî —Ö–æ—Ä–æ—à–∏–π —á–∞—Å –¥–ª—è —Å–ø—Ä–∞–≤ —ñ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π.';
    }else if(dayInCycle>=cycleLen-7 && dayInCycle<=cycleLen){
      text='–ü–µ—Ä–µ–¥–º–µ–Ω—Å—Ç—Ä—É–∞–ª—å–Ω–∞ —Ñ–∞–∑–∞. –ú–æ–∂–ª–∏–≤—ñ –ø–µ—Ä–µ–ø–∞–¥–∏ –Ω–∞—Å—Ç—Ä–æ—é, –Ω–∞–±—Ä—è–∫–∏ –∞–±–æ —Ç—è–≥–∞ –¥–æ —Å–æ–ª–æ–¥–∫–æ–≥–æ.';
    }else{
      text='–¶–∏–∫–ª —Ç—Ä–æ—Ö–∏ –≤–∏—Ö–æ–¥–∏—Ç—å –∑–∞ –∑–≤–∏—á–Ω–∏–π. –Ø–∫—â–æ —Ç–∞–∫ —á–∞—Å—Ç–æ ‚Äî –≤–∞—Ä—Ç–æ –ø–æ—Ä–∞–¥–∏—Ç–∏—Å—å —ñ–∑ –ª—ñ–∫–∞—Ä–µ–º.';
    }

    if(syms.includes('–ë—ñ–ª—å')) text+=' –¢–∏ –≤—ñ–¥–º—ñ—Ç–∏–ª–∞ –±—ñ–ª—å ‚Äî –¥–∞–π —Å–æ–±—ñ —Å–ø–æ–∫—ñ–π, –º–æ–∂–µ—à –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —É–∑–≥–æ–¥–∂–µ–Ω–∏–π –∑–∞—Å—ñ–±.';
    if(syms.includes('–ù–∞—Å—Ç—Ä—ñ–π')) text+=' –ù–∞—Å—Ç—Ä—ñ–π —Å–∫–∞—á–µ ‚Äî —Ü–µ —á–∞—Å—Ç–æ –≥–æ—Ä–º–æ–Ω–∏, –Ω–µ –≤–∏–Ω–∞.';
    if(syms.includes('–°–æ–Ω')) text+=' –°–æ–Ω –Ω–µ—è–∫—ñ—Å–Ω–∏–π ‚Äî –¥–æ–ø–æ–º–æ–∂–µ –ø—Ä–æ–≥—É–ª—è–Ω–∫–∞ –π –º—ñ–Ω—ñ–º—É–º –µ–∫—Ä–∞–Ω—ñ–≤ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º.';
    tipEl.innerHTML=text;
  }

  function updateInsights(){
    const el=document.getElementById('insights');
    if(Object.keys(daySymptoms).length===0){el.innerHTML='–ü–æ–∫–∏ —â–æ –º–∞–ª–æ –¥–∞–Ω–∏—Ö. –ö–æ–ª–∏ –±—É–¥–µ –∫—ñ–ª—å–∫–∞ —Ü–∏–∫–ª—ñ–≤ —ñ–∑ —Å–∏–º–ø—Ç–æ–º–∞–º–∏, –∑ º—è–≤–ª—è—Ç—å—Å—è –ø–∞—Ç–µ—Ä–Ω–∏.';return;}
    // –ø—Ä–æ—Å—Ç—ñ –ø–∞—Ç–µ—Ä–Ω–∏ –ø–æ –±–æ–ª—é –π –Ω–∞—Å—Ç—Ä–æ—é
    let painDays=[], moodDays=[];
    Object.keys(daySymptoms).forEach(dateStr=>{
      const list=daySymptoms[dateStr];
      if(!list.length) return;
      const date=new Date(dateStr);date.setHours(0,0,0,0);
      // –∑–Ω–∞–π—Ç–∏ –Ω–∞–π–±–ª–∏–∂—á–∏–π —Ü–∏–∫–ª
      let closest=null,closestDiff=1e9;
      cycles.forEach(c=>{
        const s=new Date(c.start);s.setHours(0,0,0,0);
        const diff=getDayDiff(s,date);
        if(diff>=0 && diff<closestDiff){closestDiff=diff;closest=c;}
      });
      if(!closest) return;
      const s=new Date(closest.start);s.setHours(0,0,0,0);
      const dayInCycle=getDayDiff(s,date)+1;
      if(list.includes('–ë—ñ–ª—å')) painDays.push(dayInCycle);
      if(list.includes('–ù–∞—Å—Ç—Ä—ñ–π')) moodDays.push(dayInCycle);
    });

    function summarize(arr,label){
      if(arr.length<3) return '';
      const avg=arr.reduce((s,x)=>s+x,0)/arr.length;
      return `${label} –Ω–∞–π—á–∞—Å—Ç—ñ—à–µ –≤ –¥–Ω—è—Ö —Ü–∏–∫–ª—É <strong>${Math.round(avg)}</strong> (–Ω–∞ –æ—Å–Ω–æ–≤—ñ ${arr.length} –ø–æ–∑–Ω–∞—á–æ–∫).`;
    }

    let out=[];
    const p=summarize(painDays,'–ë—ñ–ª—å'); if(p) out.push(p);
    const m=summarize(moodDays,'–ó–º—ñ–Ω–∏ –Ω–∞—Å—Ç—Ä–æ—é'); if(m) out.push(m);
    if(out.length===0){
      el.innerHTML='–í—ñ–¥–º—ñ—á–∞–π —Å–∏–º–ø—Ç–æ–º–∏ –∫—ñ–ª—å–∫–∞ —Ü–∏–∫–ª—ñ–≤ –ø–æ—Å–ø—ñ–ª—å ‚Äî —Ç–æ–¥—ñ –∑ º—è–≤–ª—è—Ç—å—Å—è –ø—Ä–æ—Å—Ç—ñ —ñ–Ω—Å–∞–π—Ç–∏ –ø—Ä–æ –±—ñ–ª—å —Ç–∞ –Ω–∞—Å—Ç—Ä—ñ–π.';
    }else{
      el.innerHTML=out.join('<br>');
    }
  }

  function buildCalendar() {
  const cont = document.getElementById('calendar');
  cont.innerHTML = '';

  const weekDays = ['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–ù–¥'];
  weekDays.forEach(d => {
    const h = document.createElement('div');
    h.className = 'day-header';
    h.textContent = d;
    cont.appendChild(h);
  });

  const today = new Date();
  today.setHours(0, 0, 0, 0);

  const year = today.getFullYear();
  const month = today.getMonth(); // –ø–æ—Ç–æ—á–Ω–∏–π –º—ñ—Å—è—Ü—å

  const startMonth = new Date(year, month, 1);
  const offset = (startMonth.getDay() + 6) % 7; // 0 = –ü–Ω

  // –ø–æ—Ä–æ–∂–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ –¥–æ 1 —á–∏—Å–ª–∞
  for (let i = 0; i < offset; i++) {
    cont.appendChild(document.createElement('div'));
  }

  const daysInMonth = new Date(year, month + 1, 0).getDate();
  const f = calcForecast(); // —Ç–≤–æ—è —ñ—Å–Ω—É—é—á–∞ —Ñ—É–Ω–∫—Ü—ñ—è –ø—Ä–æ–≥–Ω–æ–∑—É

  for (let d = 1; d <= daysInMonth; d++) {
    const date = new Date(year, month, d);
    date.setHours(0, 0, 0, 0);
    const dateStr = date.toISOString().slice(0, 10);

    const cell = document.createElement('div');
    cell.className = 'day';

    // –≤–µ—Ä—Ö–Ω—ñ–π —Ä—è–¥–æ–∫ ‚Äî —á–∏—Å–ª–æ –º—ñ—Å—è—Ü—è
    const dayNumber = document.createElement('div');
    dayNumber.textContent = d;
    cell.appendChild(dayNumber);

    if (date.getTime() === today.getTime()) {
      cell.classList.add('today');
    }

    // –§–∞–∫—Ç–∏—á–Ω—ñ –º—ñ—Å—è—á–Ω—ñ
    cycles.forEach(c => {
      const start = new Date(c.start); start.setHours(0,0,0,0);
      const end = new Date(start.getTime() + c.period * 86400000);
      if (date >= start && date < end) {
        cell.classList.add('period');
      }
    });

    // –ü—Ä–æ–≥–Ω–æ–∑ + —Ñ–µ—Ä—Ç–∏–ª—å–Ω—ñ
    if (f && cycles.length) {
      const last = cycles[0];
      const lastStart = new Date(last.start); lastStart.setHours(0,0,0,0);
      const diffFromLast = getDayDiff(lastStart, date);

      if (diffFromLast >= f.min && diffFromLast <= f.max) {
        cell.classList.add('predicted');
      }

      const fertileStart = Math.round(f.avg - 14 - 3);
      const fertileEnd   = Math.round(f.avg - 14 + 3);
      if (diffFromLast >= fertileStart && diffFromLast <= fertileEnd) {
        cell.classList.add('fertile');
      }
    }

    // –°–∏–º–ø—Ç–æ–º–∏ (–∫—Ä–∞–ø–∫–∞)
    if (daySymptoms[dateStr] && daySymptoms[dateStr].length) {
      const dot = document.createElement('div');
      dot.className = 'dot';
      cell.appendChild(dot);
      cell.title = daySymptoms[dateStr].join(', ');
    }

    // –ù–æ–º–µ—Ä –¥–Ω—è —Ü–∏–∫–ª—É (d1, d2, ‚Ä¶)
    if (cycles.length) {
      let closest = null;
      let closestDiff = 1e9;

      cycles.forEach(c => {
        const s = new Date(c.start); s.setHours(0,0,0,0);
        const diff = getDayDiff(s, date);
        if (diff >= 0 && diff < closestDiff) {
          closestDiff = diff;
          closest = { start: s, length: c.length };
        }
      });

      if (closest && closestDiff >= 0 && closestDiff <= closest.length + 7) {
        const dayInCycle = closestDiff + 1;
        const label = document.createElement('div');
        label.className = 'cycle-day-label';
        label.textContent = 'd' + dayInCycle;
        cell.appendChild(label);
      }
    }

    cont.appendChild(cell);
  }
}

    buildSymptomChips();
    updateTodayInfo();
    updateTodayTip();
    updateInsights();
  }

  loadBaseSettings();
  refreshAll();
</script>
</body>
</html>
